

# Story 1.3: Project Creation and Configuration Management

## Status: Completed

## Story

- As a Project Manager
- I want to create and configure new projects
- so that I can organize electrical work and assign team members appropriately

## Acceptance Criteria (ACs)

1. **Project Creation Workflow:** System provides intuitive project creation with metadata capture including client details, location, timeline, and budget
2. **Team Member Assignment:** System enables assignment of team members with role-based access and lead designation capabilities
3. **Project Configuration:** System offers project settings and configuration options for workflow customization and preferences
4. **Project Management:** System includes project archive, status management, and lifecycle tracking capabilities

## Tasks / Subtasks

- [ ] **Task 1: Project Data Models and Database Schema** (AC: 1, 4)
  - [ ] Enhance existing Project model with additional metadata fields
  - [ ] Create ProjectSettings model for customizable project configurations
  - [ ] Implement ProjectMilestone model for timeline tracking
  - [ ] Add database indexes for efficient project queries and filtering

- [ ] **Task 2: Backend Project Management API** (AC: 1, 2, 3, 4)
  - [ ] Create project CRUD endpoints in FastAPI gateway service
  - [ ] Implement team member assignment and management endpoints
  - [ ] Add project settings and configuration API endpoints
  - [ ] Create project status transition and lifecycle management endpoints

- [ ] **Task 3: Frontend Project Management Interface** (AC: 1, 2, 3)
  - [ ] Create project creation form with validation and metadata capture
  - [ ] Build project dashboard with filtering and search capabilities
  - [ ] Implement team member assignment interface with role selection
  - [ ] Develop project settings and configuration management UI

- [ ] **Task 4: Project Access Control and Permissions** (AC: 2)
  - [ ] Integrate project-based permissions with existing authentication system
  - [ ] Implement project-level role assignments and access control
  - [ ] Create project lead designation and privilege management
  - [ ] Add project visibility and team member access restrictions

- [ ] **Task 5: Project Workflow and Status Management** (AC: 4)
  - [ ] Implement project status workflow (Draft → Active → Completed → Archived)
  - [ ] Create project milestone tracking and timeline management
  - [ ] Add project archive and restoration capabilities
  - [ ] Implement project deletion and data retention policies

- [ ] **Task 6: Project Analytics and Reporting** (AC: 3, 4)
  - [ ] Create project overview dashboard with key metrics
  - [ ] Implement project progress tracking and reporting
  - [ ] Add team member activity and contribution tracking
  - [ ] Create project performance analytics and insights

- [ ] **Task 7: Testing and Validation** (AC: 1, 2, 3, 4)
  - [ ] Write comprehensive unit tests for project management APIs
  - [ ] Create integration tests for project workflow and permissions
  - [ ] Implement E2E tests for project creation and team assignment
  - [ ] Add security tests for project access control and authorization

## Dev Technical Guidance

### **Database Schema Enhancements**
- **Extended Project Model Fields:**
  ```python
  # Additional fields for enhanced project metadata
  project_type: Mapped[str] = mapped_column(String(50), nullable=True)  # "brownfield", "greenfield", "maintenance"
  industry_sector: Mapped[str] = mapped_column(String(100), nullable=True)  # "oil_gas", "mining", "industrial"
  facility_type: Mapped[str] = mapped_column(String(100), nullable=True)  # "refinery", "platform", "plant"
  project_priority: Mapped[ProjectPriority] = mapped_column(Enum(ProjectPriority), default=ProjectPriority.MEDIUM)
  contract_number: Mapped[Optional[str]] = mapped_column(String(100), nullable=True)
  estimated_manhours: Mapped[Optional[float]] = mapped_column(Float, nullable=True)
  actual_manhours: Mapped[Optional[float]] = mapped_column(Float, nullable=True)
  ```

- **Project Settings Model:**
  ```python
  class ProjectSettings(BaseModel):
      project_id: Mapped[uuid.UUID] = mapped_column(ForeignKey("projects.id"))
      drawing_auto_processing: Mapped[bool] = mapped_column(Boolean, default=True)
      cloud_detection_sensitivity: Mapped[float] = mapped_column(Float, default=0.7)
      estimation_method: Mapped[str] = mapped_column(String(50), default="ml_model")
      notification_preferences: Mapped[dict] = mapped_column(JSON, nullable=True)
      custom_fields: Mapped[dict] = mapped_column(JSON, nullable=True)
  ```

### **API Endpoints Implementation**
- **Project Management APIs:**
  ```python
  # Gateway service routes (/api/v1/projects)
  POST /api/v1/projects - Create new project
  GET /api/v1/projects - List projects with filtering and pagination
  GET /api/v1/projects/{project_id} - Get project details
  PUT /api/v1/projects/{project_id} - Update project information
  DELETE /api/v1/projects/{project_id} - Archive project
  
  # Team management
  POST /api/v1/projects/{project_id}/team - Add team member
  PUT /api/v1/projects/{project_id}/team/{user_id} - Update member role
  DELETE /api/v1/projects/{project_id}/team/{user_id} - Remove team member
  GET /api/v1/projects/{project_id}/team - List team members
  
  # Project settings
  GET /api/v1/projects/{project_id}/settings - Get project settings
  PUT /api/v1/projects/{project_id}/settings - Update project settings
  ```

### **Frontend Component Architecture**
- **Project Creation Flow:**
  ```typescript
  // Multi-step project creation wizard
  1. Basic Information (name, description, client, location)
  2. Project Details (type, industry, timeline, budget)
  3. Team Assignment (select team members and roles)
  4. Configuration (settings, preferences, notifications)
  5. Review and Create (confirmation and validation)
  ```

- **Project Dashboard Components:**
  ```typescript
  // Main components for project management
  ProjectList - Filterable list with search and pagination
  ProjectCard - Summary card with key metrics and actions
  ProjectDetails - Detailed view with tabs for info, team, settings
  TeamMemberSelector - Multi-select with role assignment
  ProjectSettings - Configuration form with validation
  ProjectStatusBadge - Visual status indicator with workflow
  ```

### **Permission System Integration**
- **Project-Level Permissions:**
  ```python
  # Enhanced permission system
  "projects.create" - Create new projects
  "projects.read" - View project information
  "projects.write" - Edit project details
  "projects.delete" - Archive/delete projects
  "projects.manage_team" - Add/remove team members
  "projects.manage_settings" - Modify project configuration
  "projects.manage_all" - Full admin access to all projects
  ```

- **Role-Based Project Access:**
  ```python
  # Project team member roles
  PROJECT_LEAD - Full project access and team management
  ELECTRICAL_SUPERVISOR - Technical oversight and approval
  FIELD_COORDINATOR - Day-to-day operations and team coordination
  TEAM_MEMBER - Basic project access and task execution
  READ_ONLY - View-only access for stakeholders
  ```

### **Frontend State Management**
- **Project Store (Zustand):**
  ```typescript
  interface ProjectStore {
    // State
    projects: Project[];
    activeProject: Project | null;
    teamMembers: TeamMember[];
    projectSettings: ProjectSettings | null;
    
    // Actions
    createProject: (data: CreateProjectData) => Promise<Project>;
    updateProject: (id: string, data: UpdateProjectData) => Promise<void>;
    deleteProject: (id: string) => Promise<void>;
    setActiveProject: (project: Project) => void;
    addTeamMember: (projectId: string, member: TeamMemberData) => Promise<void>;
    removeTeamMember: (projectId: string, userId: string) => Promise<void>;
    updateProjectSettings: (projectId: string, settings: ProjectSettings) => Promise<void>;
  }
  ```

### **Validation and Security**
- **Input Validation:**
  - Project names: 3-200 characters, unique within organization
  - Dates: Start date must be <= target completion date
  - Budget: Positive numbers with currency validation
  - Team members: Valid user IDs with role verification
  - Settings: JSON schema validation for custom fields

- **Security Considerations:**
  - Project access control based on team membership
  - Audit logging for all project modifications
  - Input sanitization for text fields and descriptions
  - Rate limiting for project creation and team modifications
  - CSRF protection for state-changing operations

### **Database Migrations**
- **Alembic Migration Tasks:**
  ```python
  # New migration: add_project_enhancements
  1. Add new columns to projects table
  2. Create project_settings table
  3. Create project_milestones table  
  4. Add indexes for efficient querying
  5. Create foreign key constraints
  6. Populate default settings for existing projects
  ```

### **Integration Points**
- **Authentication Integration:** 
  - Project access control uses existing JWT and RBAC system
  - Team member roles integrate with user management system
  - Project permissions checked via middleware

- **Drawing Integration (Future Epic 2):**
  - Project ID required for all drawing uploads
  - Project settings influence drawing processing behavior
  - Team member roles determine drawing access levels

### **Testing Strategy**
- **Unit Tests:**
  - Project CRUD operations with validation
  - Team member assignment and role management
  - Project settings update and retrieval
  - Access control and permission checks

- **Integration Tests:**
  - Project creation workflow end-to-end
  - Team member notification system
  - Project status transitions and lifecycle
  - Database consistency and referential integrity

- **E2E Tests:**
  - Complete project creation wizard flow
  - Team member invitation and assignment
  - Project dashboard filtering and search
  - Project archival and restoration workflow

### **Performance Considerations**
- **Database Optimization:**
  - Indexed queries for project filtering and search
  - Efficient pagination for large project lists
  - Optimized team member lookups with joins
  - Cached project settings for frequent access

- **Frontend Optimization:**
  - Lazy loading for project details and team data
  - Optimistic updates for team member changes
  - Debounced search and filtering
  - Virtual scrolling for large project lists

## Story Progress Notes

### Agent Model Used: `Claude Sonnet 4 (2025-05-14)`

### Completion Notes List
{Implementation notes will be added during development}

### Change Log
- **2025-01-25:** Initial story creation by Technical Scrum Master following BMAD methodology